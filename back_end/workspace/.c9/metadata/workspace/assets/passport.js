{"filter":false,"title":"passport.js","tooltip":"/assets/passport.js","undoManager":{"mark":11,"position":11,"stack":[[{"start":{"row":0,"column":0},"end":{"row":5,"column":1},"action":"insert","lines":["module.exports = function(passport, user) {"," ","    var User = user;","    var LocalStrategy = require('passport-local').Strategy;"," ","}"],"id":2}],[{"start":{"row":5,"column":1},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":3}],[{"start":{"row":6,"column":0},"end":{"row":7,"column":0},"action":"insert","lines":["",""],"id":4}],[{"start":{"row":7,"column":0},"end":{"row":16,"column":3},"action":"insert","lines":["passport.use('local-signup', new LocalStrategy("," ","    {","        usernameField: 'email',","        passwordField: 'password',","        passReqToCallback: true // allows us to pass back the entire request to the callback"," ","    },"," ","));"],"id":5}],[{"start":{"row":7,"column":0},"end":{"row":7,"column":1},"action":"insert","lines":["g"],"id":6}],[{"start":{"row":7,"column":1},"end":{"row":7,"column":2},"action":"insert","lines":["l"],"id":7}],[{"start":{"row":7,"column":2},"end":{"row":7,"column":3},"action":"insert","lines":["o"],"id":8},{"start":{"row":7,"column":3},"end":{"row":7,"column":4},"action":"insert","lines":["b"]}],[{"start":{"row":7,"column":4},"end":{"row":7,"column":5},"action":"insert","lines":["a"],"id":9}],[{"start":{"row":7,"column":5},"end":{"row":7,"column":6},"action":"insert","lines":["l"],"id":10}],[{"start":{"row":7,"column":6},"end":{"row":7,"column":7},"action":"insert","lines":["."],"id":11}],[{"start":{"row":15,"column":1},"end":{"row":17,"column":1},"action":"insert","lines":["function(req, email, password, done) {"," ","}"],"id":12}],[{"start":{"row":0,"column":0},"end":{"row":18,"column":3},"action":"remove","lines":["module.exports = function(passport, user) {"," ","    var User = user;","    var LocalStrategy = require('passport-local').Strategy;"," ","}","","global.passport.use('local-signup', new LocalStrategy("," ","    {","        usernameField: 'email',","        passwordField: 'password',","        passReqToCallback: true // allows us to pass back the entire request to the callback"," ","    },"," function(req, email, password, done) {"," ","}","));"],"id":13},{"start":{"row":0,"column":0},"end":{"row":92,"column":1},"action":"insert","lines":["var bCrypt = require('bcrypt-nodejs');"," "," ","module.exports = function(passport, user) {"," "," ","    var User = user;"," ","    var LocalStrategy = require('passport-local').Strategy;"," "," ","    passport.use('local-signup', new LocalStrategy("," ","        {"," ","            usernameField: 'email',"," ","            passwordField: 'password',"," ","            passReqToCallback: true // allows us to pass back the entire request to the callback"," ","        },"," "," "," ","        function(req, email, password, done) {"," ","            var generateHash = function(password) {"," ","                return bCrypt.hashSync(password, bCrypt.genSaltSync(8), null);"," ","            };"," "," "," ","            User.findOne({","                where: {","                    email: email","                }","            }).then(function(user) {"," ","                if (user)"," ","                {"," ","                    return done(null, false, {","                        message: 'That email is already taken'","                    });"," ","                } else"," ","                {"," ","                    var userPassword = generateHash(password);"," ","                    var data ="," ","                        {","                            email: email,"," ","                            password: userPassword,"," ","                            firstname: req.body.firstname,"," ","                            lastname: req.body.lastname"," ","                        };"," ","                    User.create(data).then(function(newUser, created) {"," ","                        if (!newUser) {"," ","                            return done(null, false);"," ","                        }"," ","                        if (newUser) {"," ","                            return done(null, newUser);"," ","                        }"," ","                    });"," ","                }"," ","            });"," ","        }"," ","    ));"," ","}"]}]]},"ace":{"folds":[],"scrolltop":911,"scrollleft":0,"selection":{"start":{"row":92,"column":1},"end":{"row":92,"column":1},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":64,"state":"no_regex","mode":"ace/mode/javascript"}},"timestamp":1525554054690,"hash":"e984eeec8d9e596181d610627547230f62ceb46e"}